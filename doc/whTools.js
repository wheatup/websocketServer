if(!wh){var wh={}}wh.Event={callStacks:{},bind:function(signal,func,self){if(!wh.Event.callStacks[signal]){wh.Event.callStacks[signal]=[]}wh.Event.callStacks[signal].push({func:func,self:self,once:false})},bindOnce:function(signal,func,self){if(!wh.Event.callStacks[signal]){wh.Event.callStacks[signal]=[]}wh.Event.callStacks[signal].push({func:func,self:self,once:true})},unbind:function(signal,func,self){if(!wh.Event.callStacks[signal]){return}wh.Event.callStacks[signal].splice(wh.Event.callStacks[signal].indexOf(func),1);if(wh.Event.callStacks[signal].length==0){wh.Event.callStacks[signal]=null}},destroy:function(signal){wh.Event.callStacks[signal]=null},call:function(signal,data){console.log("call: "+signal,data);if(!wh.Event.callStacks[signal]){return}var eves=wh.Event.callStacks[signal];for(var i=0;i<eves.length;i++){var e=eves[i];e.func.call(e.self,data);if(e.once){eves.splice(i,1);i--}}if(eves.length==0){wh.Event.destroy(signal)}}};if(!wh){var wh={}}wh.Server={address:"ws://localhost:8080/TestServer/server",socket:null,connect:function(){wh.Server.socket=new WebSocket(wh.Server.address);console.log("正在连接至服务器...");wh.Server.socket.onopen=function(event){wh.Server.socket.onMessage=wh.Server.onMessage;wh.Server.socket.onClose=wh.Server.onClose;wh.Server.onOpen(event)}},onOpen:function(event){console.log("成功连接到服务器。");wh.Event.call("OnOpen")},onMessage:function(event){console.log("收到消息:\n"+event.data);wh.Event.call("OnMessage",event.data)},onClose:function(event){console.log("从服务器断开:"+event.data);wh.Event.call("OnClose",event.data)},send:function(msg){wh.Server.socket.send(msg)}};